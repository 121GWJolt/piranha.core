piranha.siteedit=new Vue({el:"#siteedit",data:{loading:!0,id:null,typeId:null,title:null,internalId:null,culture:null,description:null,hostnames:null,isDefault:!1,siteTypes:[],regions:[],isNew:!1,selectedRegion:{uid:"uid-settings",name:null,icon:null},callback:null},methods:{load:function(e){self=this,fetch(piranha.baseUrl+"manager/api/site/"+e).then(function(e){return e.json()}).then(function(e){self.id=e.id,self.typeId=e.typeId,self.title=e.title,self.internalId=e.internalId,self.culture=e.culture,self.description=e.description,self.hostnames=e.hostnames,self.isDefault=e.isDefault,self.siteTypes=e.siteTypes}).catch(function(e){console.log("error:",e)}),fetch(piranha.baseUrl+"manager/api/site/content/"+e).then(function(e){return e.json()}).then(function(e){self.regions=e.regions}).catch(function(e){console.log("error:",e)})},save:function(){var i=this,e={id:this.id,typeId:this.typeId,title:this.title,internalId:this.internalId,culture:this.culture,description:this.description,hostnames:this.hostnames,isDefault:this.isDefault};fetch(piranha.baseUrl+"manager/api/site/save",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){if(piranha.notifications.push(e),"success"===e.type){if(null!=i.id&&null!=i.typeId){var t={id:i.id,typeId:i.typeId,title:i.title,regions:JSON.parse(JSON.stringify(i.regions))};fetch(piranha.baseUrl+"manager/api/site/savecontent",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(function(e){console.log("error:",e)})}$("#siteedit").modal("hide"),i.callback&&(i.callback(),i.callback=null)}}).catch(function(e){console.log("error:",e)})},open:function(e,t){this.callback=t,this.isNew=!1,this.selectedRegion={uid:"uid-settings",name:null,icon:null},this.load(e),$("#siteedit").modal("show"),$("#sitetitle").focus()},create:function(t){var i=this;fetch(piranha.baseUrl+"manager/api/site/create").then(function(e){return e.json()}).then(function(e){i.id=e.id,i.typeId=e.typeId,i.title=e.title,i.internalId=e.internalId,i.culture=e.culture,i.description=e.description,i.hostnames=e.hostnames,i.isDefault=e.isDefault,i.siteTypes=e.siteTypes,i.isNew=!0,i.callback=t,i.selectedRegion={uid:"uid-settings",name:null,icon:null}}).catch(function(e){console.log("error:",e)}),$("#siteedit").modal("show"),$("#sitetitle").focus()},remove:function(){var t=this;fetch(piranha.baseUrl+"manager/api/site/delete/"+t.id).then(function(e){return e.json()}).then(function(e){piranha.notifications.push(e),"success"===e.type&&($("#siteedit").modal("hide"),t.callback&&(t.callback(),t.callback=null))}).catch(function(e){console.log("error:",e)})},selectRegion:function(e){this.selectedRegion=e}},updated:function(){this.loading=!1}}),$("#siteedit").on("shown.bs.modal",function(){$("#sitetitle").trigger("focus")});