Vue.component("folder-item",{props:["item","selected"],methods:{toggleItem:function(e){e.isExpanded=!e.isExpanded}},template:"<li class='dd-item expanded' :class='{ active: item.id === selected, expanded: item.isExpanded || item.items.length === 0 }' :data-id='item.id'>  <a class='droppable' v-on:click.prevent='piranha.media.load(item.id)' href='#' v-on:dragover='piranha.media.dragover' v-on:dragleave='piranha.media.dragleave' v-on:drop='piranha.media.drop($event, item.id)'>    <i class='fas fa-folder'></i>{{ item.name }}    <span class='badge badge-light float-right'>{{ item.mediaCount }}</span>  </a>  <ol v-if='item.items.length > 0' class='dd-list'>    <folder-item v-for='child in item.items' v-bind:key='child.id' v-bind:selected='selected' v-bind:item='child'></folder-item>  </ol></li>"}),piranha.media=new Vue({el:"#media",data:{loading:!0,listView:!0,currentFolderId:null,currentFolderName:null,parentFolderId:null,items:[],structure:[],rootCount:null,totalCount:null,canDelete:!1,folder:{name:null},dropzone:null},methods:{bind:function(e){this.currentFolderId=e.currentFolderId,this.currentFolderName=e.currentFolderName,this.parentFolderId=e.parentFolderId,this.items=e.media,this.structure=e.structure,this.rootCount=e.rootCount,this.totalCount=e.totalCount,this.canDelete=e.canDelete,this.listView="list"===e.viewMode},drag:function(e,t){e.dataTransfer.setData("mediaId",t.id)},dragover:function(e){e.preventDefault();var t=$(e.target).closest(".droppable");t.hasClass("active")||t.addClass("active")},dragleave:function(e){e.preventDefault();var t=$(e.target).closest(".droppable");t.hasClass("active")&&t.removeClass("active")},drop:function(e,t){e.preventDefault();var a=$(e.target).closest(".droppable");a.hasClass("active")&&a.removeClass("active");var n=e.dataTransfer.getData("mediaId");fetch(piranha.baseUrl+"manager/api/media/move/"+n+"/"+(t||"")).then(function(e){return e.json()}).then(function(e){"success"===e.type&&piranha.media.refresh(),piranha.notifications.push(e)}).catch(function(e){console.log("error:",e)})},showList:function(){this.listView=!0},showGallery:function(){this.listView=!1},load:function(e,t){var a=this;t||history.pushState({folderId:e},"",piranha.baseUrl+"manager/media"+(e?"/"+e:"")),fetch(piranha.baseUrl+"manager/api/media/list"+(e?"/"+e:"")+"/?width=210&height=160").then(function(e){return e.json()}).then(function(e){a.bind(e),document.title=e.currentFolderName?e.currentFolderName:"Media"}).catch(function(e){console.log("error:",e)})},getThumbnailUrl:function(e){return null!==e.altVersionUrl?e.altVersionUrl:piranha.baseUrl+"manager/api/media/url/"+e.id+"/210/160"},refresh:function(){piranha.media.load(piranha.media.currentFolderId)},addFolder:function(){this.saveFolder("#folderAdd","folderAddForm",{parentId:this.currentFolderId,name:this.folder.name})},updateFolder:function(){this.saveFolder("#folderEdit","folderEditForm",{id:this.currentFolderId,name:this.currentFolderName})},saveFolder:function(e,t,a){var n=this;!1!==(t=document.getElementById(t)).checkValidity()?fetch(piranha.baseUrl+"manager/api/media/folder/save",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(e){return e.json()}).then(function(t){"success"===t.status.type&&($(e).collapse("hide"),n.folder.name=null,n.items=t.media,n.refresh()),piranha.notifications.push(t.status)}).catch(function(e){console.log("error:",e)}):t.classList.add("was-validated")},remove:function(e){var t=this;fetch(piranha.baseUrl+"manager/api/media/delete/"+e).then(function(e){return e.json()}).then(function(e){t.bind(e),piranha.notifications.push(e.status)}).catch(function(e){console.log("error:",e)})},removeFolder:function(e){var t=this;fetch(piranha.baseUrl+"manager/api/media/folder/delete/"+e).then(function(e){return e.json()}).then(function(a){t.bind(a),history.pushState({folderId:e},"",piranha.baseUrl+"manager/media"+(e?"/"+e:"")),document.title=a.currentFolderName?a.currentFolderName:"Media",piranha.notifications.push(a.status)}).catch(function(e){console.log("error:",e)})}},updated:function(){this.loading&&(piranha.permissions.media.add&&(this.dropzone=piranha.dropzone.init("#media-upload-container",{uploadMultiple:!1}),this.dropzone.on("complete",function(e){"success"===e.status&&setTimeout(function(){piranha.media.dropzone.removeFile(e)},3e3)}),this.dropzone.on("queuecomplete",function(){piranha.media.refresh()})),this.loading=!1)},mounted:function(){var e=this;window.onpopstate=function(t){e.load(t.state&&t.state.folderId?t.state.folderId:"",!0)}}}),$(document).on("shown.bs.modal","#mediaFolderModal",function(e){$("#mediaFolderName").focus()});