Vue.component("sitemap-item",{props:["item"],methods:{toggleItem:function(e){e.isExpanded?(console.log("Setting item.isExpanded = false"),e.isExpanded=!1):(console.log("Setting item.isExpanded = true"),e.isExpanded=!0)}},template:"<li class='dd-item' :class='{ expanded: item.isExpanded || item.items.length === 0 }' :data-id='item.id'>  <div class='sitemap-item'>    <div class='handle dd-handle'><i class='fas fa-ellipsis-v'></i></div>    <div class='link'>      <span v-if='item.items.length > 0' class='actions'>        <a v-if='item.isExpanded' v-on:click.prevent='toggleItem(item)' class='expand' href='#'><i class='fas fa-minus'></i></a>        <a v-if='!item.isExpanded' v-on:click.prevent='toggleItem(item)' class='expand' href='#'><i class='fas fa-plus'></i></a>      </span>      <a :href='piranha.baseUrl + item.editUrl + item.id'>        {{ item.title }}        <span v-if='item.status' class='badge badge-primary'>{{ item.status }}</span>      </a>    </div>    <div class='type d-none d-md-block'>{{ item.typeName }}</div>    <div class='date d-none d-md-block'>{{ item.published }}</div>    <div class='actions'>      <a href='#' data-toggle='modal' data-target='#pageAddModal'><i class='fas fa-angle-down'></i></a>      <a href='#' data-toggle='modal' data-target='#pageAddModal'><i class='fas fa-angle-right'></i></a>      <a v-if='item.items.length === 0' v-on:click.prevent='piranha.pagelist.remove(item.id)' class='danger' href='#'><i class='fas fa-trash'></i></a>    </div>  </div>  <ol v-if='item.items.length > 0' class='dd-list'>    <sitemap-item v-for='child in item.items' v-bind:key='child.id' v-bind:item='child'>    </sitemap-item>  </ol></li>"}),piranha.pagelist=new Vue({el:"#pagelist",data:{loading:!0,updateBindings:!1,items:[],sites:[],pageTypes:[]},methods:{load:function(){fetch(piranha.baseUrl+"manager/api/page/list").then(function(e){return e.json()}).then(function(e){piranha.pagelist.sites=e.sites,piranha.pagelist.pageTypes=e.pageTypes,piranha.pagelist.updateBindings=!0}).catch(function(e){console.log("error:",e)})},remove:function(e){var i=this;fetch(piranha.baseUrl+"manager/api/page/delete/"+e).then(function(e){return e.json()}).then(function(e){piranha.notifications.push(e),i.load()}).catch(function(e){console.log("error:",e)})},bind:function(){var a=this;$(".sitemap-container").nestable({maxDepth:100,group:1,callback:function(e,i){fetch(piranha.baseUrl+"manager/api/page/move",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:$(i).attr("data-id"),items:$(e).nestable("serialize")})}).then(function(e){return e.json()}).then(function(e){piranha.notifications.push(e.status),"success"===e.status.type&&($(".sitemap-container").nestable("destroy"),a.sites=[],Vue.nextTick(function(){a.sites=e.sites,Vue.nextTick(function(){a.bind()})}))}).catch(function(e){console.log("error:",e)})}})}},created:function(){},updated:function(){this.updateBindings&&(this.bind(),this.updateBindings=!1),this.loading=!1}});