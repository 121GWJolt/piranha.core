piranha.postedit=new Vue({el:"#postedit",data:{loading:!0,id:null,blogId:null,typeId:null,title:null,slug:null,metaKeywords:null,metaDescription:null,published:null,state:"new",categories:[],tags:[],blocks:[],regions:[],editors:[],useBlocks:!0,saving:!1,savingDraft:!1,selectedRegion:{uid:"uid-blocks",name:null,icon:null},selectedSetting:"uid-settings",selectedCategory:null,selectedTags:[]},computed:{contentRegions:function(){return this.regions.filter(function(t){return"setting"!=t.meta.display&&"hidden"!=t.meta.display})},settingRegions:function(){return this.regions.filter(function(t){return"setting"===t.meta.display})}},methods:{bind:function(t){this.id=t.id,this.blogId=t.blogId,this.typeId=t.typeId,this.title=t.title,this.slug=t.slug,this.metaKeywords=t.metaKeywords,this.metaDescription=t.metaDescription,this.published=t.published,this.state=t.state,this.blocks=t.blocks,this.regions=t.regions,this.editors=t.editors,this.categories=t.categories,this.tags=t.tags,this.useBlocks=t.useBlocks,this.selectedCategory=t.selectedCategory,this.selectedTags=t.selectedTags,this.useBlocks||(0<this.editors.length?this.selectedRegion=this.editors[0]:0<this.contentRegions.length&&(this.selectedRegion=this.contentRegions[0].meta))},load:function(t){var e=this;fetch(piranha.baseUrl+"manager/api/post/"+t).then(function(t){return t.json()}).then(function(t){e.bind(t)}).catch(function(t){console.log("error:",t)})},create:function(t,e){var n=this;fetch(piranha.baseUrl+"manager/api/post/create/"+t+"/"+e).then(function(t){return t.json()}).then(function(t){n.bind(t)}).catch(function(t){console.log("error:",t)})},save:function(){this.saving=!0,this.saveInternal(piranha.baseUrl+"manager/api/post/save")},saveDraft:function(){this.savingDraft=!0,this.saveInternal(piranha.baseUrl+"manager/api/post/save/draft")},unpublish:function(){this.saving=!0,this.saveInternal(piranha.baseUrl+"manager/api/post/save/unpublish")},saveInternal:function(t){var n=this,e={id:n.id,blogId:n.blogId,typeId:n.typeId,title:n.title,slug:n.slug,metaKeywords:n.metaKeywords,metaDescription:n.metaDescription,published:n.published,blocks:JSON.parse(JSON.stringify(n.blocks)),regions:JSON.parse(JSON.stringify(n.regions))};fetch(t,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(t){return t.json()}).then(function(t){var e=n.state;n.id=t.id,n.slug=t.slug,n.published=t.published,n.state=t.state,"new"===e&&"new"!==t.state&&window.history.replaceState({state:"created"},"Edit post",piranha.baseUrl+"manager/post/edit/"+t.id),piranha.notifications.push(t.status),n.saving=!1,n.savingDraft=!1}).catch(function(t){console.log("error:",t)})},revert:function(){var e=this;fetch(piranha.baseUrl+"manager/api/post/revert/"+e.id).then(function(t){return t.json()}).then(function(t){e.bind(t),piranha.notifications.push(t.status)}).catch(function(t){console.log("error:",t)})},remove:function(){var e=this;fetch(piranha.baseUrl+"manager/api/post/delete/"+e.id).then(function(t){return t.json()}).then(function(t){piranha.notifications.push(t),window.location=piranha.baseUrl+"manager/page/"+e.blogId}).catch(function(t){console.log("error:",t)})},addBlock:function(t,e){var n=this;fetch(piranha.baseUrl+"manager/api/content/block/"+t).then(function(t){return t.json()}).then(function(t){n.blocks.splice(e,0,t.body)}).catch(function(t){console.log("error:",t)})},moveBlock:function(t,e){this.blocks.splice(e,0,this.blocks.splice(t,1)[0])},collapseBlock:function(t){t.meta.isCollapsed=!t.meta.isCollapsed},removeBlock:function(t){var e=this.blocks.indexOf(t);-1!==e&&this.blocks.splice(e,1)},selectRegion:function(t){this.selectedRegion=t},selectSetting:function(t){this.selectedSetting=t}},created:function(){},updated:function(){var e=this;this.loading?(sortable(".blocks",{handle:".handle",items:":not(.unsortable)"})[0].addEventListener("sortupdate",function(t){e.moveBlock(t.detail.origin.index,t.detail.destination.index)}),$(".select2").select2({tags:!0})):(sortable(".blocks","disable"),sortable(".blocks","enable")),this.loading=!1}});