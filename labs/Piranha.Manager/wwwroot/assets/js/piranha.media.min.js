piranha.media=new Vue({el:"#media",data:{listView:!0,currentFolderId:null,parentFolderId:null,folders:[],items:[],folder:{name:null},dropzone:null},methods:{drag:function(e,a){e.dataTransfer.setData("mediaId",a.id)},dragover:function(e){e.preventDefault();var a=e.target.closest(".droppable");a.classList.contains("actice")||a.classList.add("active")},dragleave:function(e){e.preventDefault();var a=e.target.closest(".droppable");a.classList.contains("actice")||a.classList.remove("active")},drop:function(e,a){e.preventDefault();var n=e.target.closest(".droppable");n.classList.contains("actice")||n.classList.remove("active");var o=e.dataTransfer.getData("mediaId");console.log("Media ID",o),console.log("Folder ID",a.id)},toggle:function(){this.listView=!this.listView},load:function(e){fetch(piranha.baseUrl+"manager/api/media/list"+(e?"/"+e:"")).then(function(e){return e.json()}).then(function(e){piranha.media.currentFolderId=e.currentFolderId,piranha.media.parentFolderId=e.parentFolderId,piranha.media.folders=e.folders,piranha.media.items=e.media}).catch(function(e){console.log("error:",e)})},refresh:function(){piranha.media.load(piranha.media.currentFolderId)},savefolder:function(){fetch(piranha.baseUrl+"manager/api/media/savefolder",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({parentId:piranha.media.currentFolderId,name:piranha.media.folder.name})}).then(function(e){return e.json()}).then(function(e){"success"===e.status.type&&($("#mediaFolderModal").modal("hide"),piranha.media.folder.name=null,piranha.media.folders=e.folders,piranha.media.items=e.media),piranha.notifications.push(e.status)}).catch(function(e){console.log("error:",e)})},remove:function(e){console.log("Remove media: ",e)},removeFolder:function(e){console.log("Remove folder: ",e)}},created:function(){this.load()},mounted:function(){var e={init:function(){this.on("complete",function(e){if(console.log("media complete",e),"success"===e.status)e.previewElement.classList.add("dz-remove"),setTimeout(function(){piranha.media.dropzone.removeFile(e)},1e3);else{var a=JSON.parse(e.xhr.responseText);e.previewElement.querySelector(".file-error span").innerText=a.body}}),this.on("queuecomplete",function(e){console.log("media queuecomplete",e),piranha.media.refresh()})}};this.dropzone=piranha.dropzone.init("#dropzone",e)}});