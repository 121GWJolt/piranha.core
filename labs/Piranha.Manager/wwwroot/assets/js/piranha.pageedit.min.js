Vue.component("html-block",{props:["gid","block"],methods:{onBlur:function(e){this.block.body.value=e.target.innerHTML}},mounted:function(){piranha.editor.addInline(this.gid)},beforeDestroy:function(){piranha.editor.remove(this.gid)},template:"<div contenteditable='true' :id='gid' spellcheck='false' v-html='block.body.value' v-on:blur='onBlur'></div>"}),Vue.component("html-column-block",{props:["gid","block"],methods:{onBlurCol1:function(e){this.block.column1.value=e.target.innerHTML},onBlurCol2:function(e){this.block.column2.value=e.target.innerHTML}},mounted:function(){piranha.editor.addInline(this.gid+1),piranha.editor.addInline(this.gid+2)},beforeDestroy:function(){piranha.editor.remove(this.gid+1),piranha.editor.remove(this.gid+2)},template:"<div class='row'>  <div :id='gid + 1' class='col-md-6'>    <div contenteditable='true' spellcheck='false' v-html='block.column1.value' v-on:blur='onBlurCol1'></div>  </div>  <div :id='gid + 2' class='col-md-6'>    <div contenteditable='true' spellcheck='false' v-html='block.column2.value' v-on:blur='onBlurCol2'></div>  </div></div>"}),Vue.component("image-block",{props:["block"],template:"<div>  <img :src='block.body.media.publicUrl.substring(1)'>  <div class='media-picker'>    <div class='btn-group float-right'>      <button class='btn btn-primary text-center'>        <i class='fas fa-plus'></i>      </button>      <button class='btn btn-danger text-center'>        <i class='fas fa-times'></i>      </button>    </div>    <div class='card text-left'>      <div class='card-body'>        {{ block.body.media.filename }}      </div>    </div>  </div></div>"}),Vue.component("text-block",{props:["block"],methods:{onBlur:function(e){this.block.body.value=e.target.innerHTML}},template:"<pre contenteditable='true' spellcheck='false' v-html='block.body.value' v-on:blur='onBlur'></pre>"}),Vue.component("missing-block",{props:["block"],template:"<div class='alert alert-danger' role='alert'>Missing Component</div>"}),piranha.pageedit=new Vue({el:"#pageedit",data:{loading:!0,id:null,siteId:null,parentId:null,typeId:null,title:null,navigationTitle:null,slug:null,metaKeywords:null,metaDescription:null,blocks:[]},methods:{load:function(e){fetch(piranha.baseUrl+"manager/api/page/"+e).then(function(e){return e.json()}).then(function(e){piranha.pageedit.id=e.id,piranha.pageedit.siteId=e.siteId,piranha.pageedit.parentId=e.parentId,piranha.pageedit.typeId=e.typeId,piranha.pageedit.title=e.title,piranha.pageedit.navigationTitle=e.navigationTitle,piranha.pageedit.slug=e.slug,piranha.pageedit.metaKeywords=e.metaKeywords,piranha.pageedit.metaDescription=e.metaDescription,piranha.pageedit.blocks=e.blocks}).catch(function(e){console.log("error:",e)})},remove:function(e){console.log("Remove page: ",e)},addBlock:function(e,t){fetch(piranha.baseUrl+"manager/api/content/block/"+e).then(function(e){return e.json()}).then(function(e){t?piranha.pageedit.blocks.splice(t,0,e):piranha.pageedit.blocks.push(e)}).catch(function(e){console.log("error:",e)})},moveBlock:function(e,t){this.blocks.splice(t,0,this.blocks.splice(e,1)[0])},removeBlock:function(e){var t=this.blocks.indexOf(e);-1!==t&&this.blocks.splice(t,1)}},created:function(){},updated:function(){sortable(".blocks",{handle:".handle",items:":not(.unsortable)"})[0].addEventListener("sortupdate",function(e){piranha.pageedit.moveBlock(e.detail.origin.index,e.detail.destination.index)}),this.loading=!1}});