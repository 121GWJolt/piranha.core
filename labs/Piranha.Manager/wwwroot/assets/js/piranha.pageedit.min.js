Vue.component("block-group",{props:["uid","model"],methods:{selectItem:function(e){for(var i=0;i<this.model.items.length;i++)this.model.items[i]==e?this.model.items[i].isActive=!0:this.model.items[i].isActive=!1},removeItem:function(e){var i=e.isActive,t=this.model.items.indexOf(e);this.model.items.splice(t,1),i&&this.selectItem(this.model.items[Math.min(t,this.model.items.length-1)])},addGroupBlock:function(e,i){var t=this;fetch(piranha.baseUrl+"manager/api/content/block/"+e).then(function(e){return e.json()}).then(function(e){t.model.items.push(e),t.selectItem(e)}).catch(function(e){console.log("error:",e)})}},mounted:function(){},beforeDestroy:function(){},template:"<div class='block-group'>  <div class='block-group-header'>    TODO: Global group fields  </div>  <div class='row'>    <div class='col-md-4'>      <div class='list-group list-group-flush'>        <div class='list-group-item' :class='{ active: child.isActive }' v-for='child in model.items' v-bind:key='child.uid'>          <a href='#' v-on:click.prevent='selectItem(child)'>            <span class='handle sortable-handle'>              <i class='fas fa-ellipsis-v'></i>            </span>            List item          </a>          <span class='actions float-right'>            <a v-on:click.prevent='removeItem(child)' href='#' class='danger'><i class='fas fa-trash'></i></a>          </span>        </div>      </div>      <button v-on:click.prevent='piranha.blockpicker.open(addGroupBlock, 0, model.type)' class='btn btn-sm btn-primary btn-labeled mt-3'><i class='fas fa-plus'></i>Add item</button>    </div>    <div class='col-md-8'>      <div v-for='child in model.items' v-if='child.isActive' :class='\"block \" + child.component'>        <component v-bind:is='child.component' v-bind:uid='child.uid' v-bind:model='child.model'></component>      </div>    </div>  </div></div>"}),Vue.component("html-block",{props:["uid","model"],methods:{onBlur:function(e){this.model.body.value=e.target.innerHTML}},computed:{isEmpty:function(){return piranha.utils.isEmptyHtml(this.model.body.value)}},mounted:function(){piranha.editor.addInline(this.uid)},beforeDestroy:function(){piranha.editor.remove(this.uid)},template:"<div :class='{ empty: isEmpty }'>  <div contenteditable='true' :id='uid' spellcheck='false' v-html='model.body.value' v-on:blur='onBlur'></div></div>"}),Vue.component("html-column-block",{props:["uid","model"],methods:{onBlurCol1:function(e){this.model.column1.value=e.target.innerHTML},onBlurCol2:function(e){this.model.column2.value=e.target.innerHTML}},computed:{isEmpty1:function(){return piranha.utils.isEmptyHtml(this.model.column1.value)},isEmpty2:function(){return piranha.utils.isEmptyHtml(this.model.column2.value)}},mounted:function(){piranha.editor.addInline(this.uid+1),piranha.editor.addInline(this.uid+2)},beforeDestroy:function(){piranha.editor.remove(this.uid+1),piranha.editor.remove(this.uid+2)},template:"<div class='row'>  <div class='col-md-6'>    <div :class='{ empty: isEmpty1 }'>      <div :id='uid + 1' contenteditable='true' spellcheck='false' v-html='model.column1.value' v-on:blur='onBlurCol1'></div>    </div>  </div>  <div class='col-md-6'>    <div :class='{ empty: isEmpty2 }'>      <div :id='uid + 2' contenteditable='true' spellcheck='false' v-html='model.column2.value' v-on:blur='onBlurCol2'></div>    </div>  </div></div>"}),Vue.component("image-block",{props:["model"],methods:{clear:function(){},select:function(){piranha.mediapicker.open(this.update)},remove:function(){this.model.body.media=null},update:function(e){"Image"===e.type?(this.model.body.id=e.id,this.model.body.media=e):console.log("No image was selected")}},computed:{isEmpty:function(){return null==this.model.body.media},mediaUrl:function(){return null!=this.model.body.media?piranha.utils.formatUrl(this.model.body.media.publicUrl):piranha.utils.formatUrl("~/assets/img/empty-image.png")}},mounted:function(){this.model.getTitle=function(){return null!=this.model.media?this.model.media.filename:"No image selected"}},template:"<div :class='{ empty: isEmpty }'>  <img :src='mediaUrl'>  <div class='media-picker'>    <div class='btn-group float-right'>      <button v-on:click.prevent='select' class='btn btn-primary text-center'>        <i class='fas fa-plus'></i>      </button>      <button v-on:click.prevent='remove' class='btn btn-danger text-center'>        <i class='fas fa-times'></i>      </button>    </div>    <div class='card text-left'>      <div class='card-body' v-if='isEmpty'>        &nbsp;      </div>      <div class='card-body' v-else>        {{ model.body.media.filename }}      </div>    </div>  </div></div>"}),Vue.component("text-block",{props:["model"],methods:{onBlur:function(e){this.model.body.value=e.target.innerHTML}},computed:{isEmpty:function(){return piranha.utils.isEmptyText(this.model.body.value)}},template:"<div :class='{ empty: isEmpty }'>  <pre contenteditable='true' spellcheck='false' v-html='model.body.value' v-on:blur='onBlur'></pre></div>"}),Vue.component("missing-block",{props:["model"],template:"<div class='alert alert-danger' role='alert'>Missing Component</div>"}),piranha.pageedit=new Vue({el:"#pageedit",data:{loading:!0,id:null,siteId:null,parentId:null,sortOrder:0,typeId:null,title:null,navigationTitle:null,slug:null,metaKeywords:null,metaDescription:null,published:null,blocks:[]},methods:{load:function(e){fetch(piranha.baseUrl+"manager/api/page/"+e).then(function(e){return e.json()}).then(function(e){piranha.pageedit.id=e.id,piranha.pageedit.siteId=e.siteId,piranha.pageedit.parentId=e.parentId,piranha.pageedit.sortOrder=e.sortOrder,piranha.pageedit.typeId=e.typeId,piranha.pageedit.title=e.title,piranha.pageedit.navigationTitle=e.navigationTitle,piranha.pageedit.slug=e.slug,piranha.pageedit.metaKeywords=e.metaKeywords,piranha.pageedit.metaDescription=e.metaDescription,piranha.pageedit.published=e.published,piranha.pageedit.blocks=e.blocks}).catch(function(e){console.log("error:",e)})},remove:function(e){console.log("Remove page: ",e)},addBlock:function(e,i){fetch(piranha.baseUrl+"manager/api/content/block/"+e).then(function(e){return e.json()}).then(function(e){piranha.pageedit.blocks.splice(i,0,e)}).catch(function(e){console.log("error:",e)})},moveBlock:function(e,i){this.blocks.splice(i,0,this.blocks.splice(e,1)[0])},removeBlock:function(e){var i=this.blocks.indexOf(e);-1!==i&&this.blocks.splice(i,1)}},created:function(){},updated:function(){this.loading?sortable(".blocks",{handle:".handle",items:":not(.unsortable)"})[0].addEventListener("sortupdate",function(e){piranha.pageedit.moveBlock(e.detail.origin.index,e.detail.destination.index)}):(sortable(".blocks","disable"),sortable(".blocks","enable")),this.loading=!1}});