var sortable=function(){"use strict";function h(e,t,n){if(void 0===n)return e&&e.h5s&&e.h5s.data&&e.h5s.data[t];e.h5s=e.h5s||{},e.h5s.data=e.h5s.data||{},e.h5s.data[t]=n}function p(e,t){if(!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof t?Array.from(e):Array.from(e).filter(function(e){return 1===e.nodeType&&e.matches(t)})}var f=new Map,t=function(){function e(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(e.prototype,"config",{get:function(){var n={};return this._config.forEach(function(e,t){n[t]=e}),n},set:function(e){if("object"!=typeof e)throw new Error("You must provide a valid configuration object to the config setter.");var t=Object.assign({},e);this._config=new Map(Object.entries(t))},enumerable:!0,configurable:!0}),e.prototype.setConfig=function(e,t){if(!this._config.has(e))throw new Error("Trying to set invalid configuration item: "+e);this._config.set(e,t)},e.prototype.getConfig=function(e){if(!this._config.has(e))throw new Error("Invalid configuration item requested: "+e);return this._config.get(e)},Object.defineProperty(e.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){if(!(e instanceof HTMLElement)&&null!==e)throw new Error("A placeholder must be an html element or null.");this._placeholder=e},enumerable:!0,configurable:!0}),e.prototype.setData=function(e,t){if("string"!=typeof e)throw new Error("The key must be a string.");this._data.set(e,t)},e.prototype.getData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.get(e)},e.prototype.deleteData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.delete(e)},e}();function u(e){if(!(e instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return f.has(e)||f.set(e,new t),f.get(e)}function m(e,t,n){if(e instanceof Array)for(var i=0;i<e.length;++i)m(e[i],t,n);else e.addEventListener(t,n),u(e).setData("event"+t,n)}function s(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)s(e[n],t);else e.removeEventListener(t,u(e).getData("event"+t)),u(e).deleteData("event"+t)}function g(e,t,n){if(e instanceof Array)for(var i=0;i<e.length;++i)g(e[i],t,n);else e.setAttribute(t,n)}function l(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)l(e[n],t);else e.removeAttribute(t)}function v(e){if(!e.parentElement||0===e.getClientRects().length)throw new Error("target element must be part of the dom");var t=e.getClientRects()[0];return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,bottom:t.bottom+window.pageYOffset}}function E(e,t){if(!(e instanceof HTMLElement&&(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(t).indexOf(e)}function b(e){if(!(e instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==e.parentNode}var n=function(e,t,n){if(!(e instanceof HTMLElement&&e.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");e.parentElement.insertBefore(t,"before"===n?e:e.nextElementSibling)},y=function(e,t){return n(e,t,"before")},C=function(e,t){return n(e,t,"after")};function N(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var n=window.getComputedStyle(e);return["height","padding-top","padding-bottom"].map(function(e){var t=parseInt(n.getPropertyValue(e),10);return isNaN(t)?0:t}).reduce(function(e,t){return e+t})}function d(e,t){if(!(e instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof t?e:e.filter(function(e){return e.querySelector(t)instanceof HTMLElement||e.shadowRoot&&e.shadowRoot.querySelector(t)instanceof HTMLElement}).map(function(e){return e.querySelector(t)||e.shadowRoot&&e.shadowRoot.querySelector(t)})}function w(e){return e.composedPath&&e.composedPath()[0]||e.target}var T=function(e,t,n){return{element:e,posX:n.pageX-t.left,posY:n.pageY-t.top}};function x(e,t){if(!0===e.isSortable){var n=u(e).getConfig("acceptFrom");if(null!==n&&!1!==n&&"string"!=typeof n)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==n)return!1!==n&&0<n.split(",").filter(function(e){return 0<e.length&&t.matches(e)}).length;if(e===t)return!0;if(void 0!==u(e).getConfig("connectWith")&&null!==u(e).getConfig("connectWith"))return u(e).getConfig("connectWith")===u(t).getConfig("connectWith")}return!1}var L,Y,I,D,S,X,A,M,H={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null};function _(e,t){if("string"==typeof u(e).getConfig("hoverClass")){var o=u(e).getConfig("hoverClass").split(" ");!0===t?(m(e,"mousemove",function(i,o){var r=this;if(void 0===o&&(o=250),"function"!=typeof i)throw new Error("You must provide a function as the first argument for throttle.");if("number"!=typeof o)throw new Error("You must provide a number as the second argument for throttle.");var a=null;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=Date.now();(null===a||o<=n-a)&&(a=n,i.apply(r,e))}}(function(i){0===i.buttons&&p(e.children,u(e).getConfig("items")).forEach(function(e){var t,n;e!==i.target?(t=e.classList).remove.apply(t,o):(n=e.classList).add.apply(n,o)})},u(e).getConfig("throttleTime"))),m(e,"mouseleave",function(){p(e.children,u(e).getConfig("items")).forEach(function(e){var t;(t=e.classList).remove.apply(t,o)})})):(s(e,"mousemove"),s(e,"mouseleave"))}}var c=function(e){s(e,"dragstart"),s(e,"dragend"),s(e,"dragover"),s(e,"dragenter"),s(e,"drop"),s(e,"mouseenter"),s(e,"mouseleave")},k=function(e,t){var n=e;return!0===u(t).getConfig("copy")&&(g(n=e.cloneNode(!0),"aria-copied","true"),e.parentElement.appendChild(n),n.style.display="none",n.oldDisplay=e.style.display),n};function O(e,t){if(t.composedPath)return t.composedPath().find(function(e){return e.isSortable});for(;!0!==e.isSortable;)e=e.parentElement;return e}function P(e,t){var n=h(e,"opts"),i=p(e.children,n.items).filter(function(e){return e.contains(t)||e.shadowRoot&&e.shadowRoot.contains(t)});return 0<i.length?i[0]:t}var i=function(e){var t,n,i,o=h(e,"opts")||{},r=p(e.children,o.items),a=d(r,o.handle);s(e,"dragover"),s(e,"dragenter"),s(e,"drop"),(n=t=e).h5s&&delete n.h5s.data,l(t,"aria-dropeffect"),s(a,"mousedown"),c(r),l(i=r,"aria-grabbed"),l(i,"aria-copied"),l(i,"draggable"),l(i,"role")},R=function(e){var t=h(e,"opts"),n=p(e.children,t.items),i=d(n,t.handle);(g(e,"aria-dropeffect","move"),h(e,"_disabled","false"),g(i,"draggable","true"),!1===t.disableIEFix)&&("function"==typeof(document||window.document).createElement("span").dragDrop&&m(i,"mousedown",function(){if(-1!==n.indexOf(this))this.dragDrop();else{for(var e=this.parentElement;-1===n.indexOf(e);)e=e.parentElement;e.dragDrop()}}))},j=function(e){var t=h(e,"opts"),n=p(e.children,t.items),i=d(n,t.handle);h(e,"_disabled","false"),c(n),s(i,"mousedown"),s(e,"dragover"),s(e,"dragenter"),s(e,"drop")};function W(e,c){var d=String(c);return c=c||{},"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),e=Array.prototype.slice.call(e),/serialize/.test(d)?e.map(function(e){var t=h(e,"opts");return function(t,n,e){if(void 0===n&&(n=function(e,t){return e}),void 0===e&&(e=function(e){return e}),!(t instanceof HTMLElement)||1==!t.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof n||"function"!=typeof e)throw new Error("You need to provide a valid serializer for items and the container.");var i=h(t,"opts").items,o=p(t.children,i),r=o.map(function(e){return{parent:t,node:e,html:e.outerHTML,index:E(e,o)}});return{container:e({node:t,itemCount:r.length}),items:r.map(function(e){return n(e,t)})}}(e,t.itemSerializer,t.containerSerializer)}):(e.forEach(function(l){if(/enable|disable|destroy/.test(d))return W[d](l);["connectWith","disableIEFix"].forEach(function(e){c.hasOwnProperty(e)&&null!==c[e]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+e+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')}),c=Object.assign({},H,u(l).config,c),u(l).config=c,h(l,"opts",c),l.isSortable=!0,j(l);var e,t=p(l.children,c.items);if(null!==c.placeholder&&void 0!==c.placeholder){var n=document.createElement(l.tagName);c.placeholder instanceof HTMLElement?n.appendChild(c.placeholder):n.innerHTML=c.placeholder,e=n.children[0]}u(l).placeholder=function(e,t,n){if(void 0===n&&(n="sortable-placeholder"),!(e instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(t instanceof HTMLElement)&&void 0!==t)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===t&&(["UL","OL"].includes(e.tagName)?t=document.createElement("li"):["TABLE","TBODY"].includes(e.tagName)?(t=document.createElement("tr")).innerHTML='<td colspan="100"></td>':t=document.createElement("div")),"string"==typeof n&&(i=t.classList).add.apply(i,n.split(" ")),t;var i}(l,e,c.placeholderClass),h(l,"items",c.items),c.acceptFrom?h(l,"acceptFrom",c.acceptFrom):c.connectWith&&h(l,"connectWith",c.connectWith),R(l),g(t,"role","option"),g(t,"aria-grabbed","false"),_(l,!0),m(l,"dragstart",function(e){var t=w(e);if(!0!==t.isSortable&&(e.stopImmediatePropagation(),(!c.handle||t.matches(c.handle))&&"false"!==t.getAttribute("draggable"))){var n=O(t,e),i=P(n,t);X=p(n.children,c.items),D=X.indexOf(i),S=E(i,n.children),I=n,function(e,t,n){if(!(e instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(t instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(n||(n=T),e.dataTransfer&&e.dataTransfer.setDragImage){var i=n(t,v(t),e);if(!(i.element instanceof HTMLElement)||"number"!=typeof i.posX||"number"!=typeof i.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",w(e).id),e.dataTransfer.setDragImage(i.element,i.posX,i.posY)}}(e,i,c.customDragImage),Y=N(i),i.classList.add(c.draggingClass),g(L=k(i,n),"aria-grabbed","true"),n.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:S,index:D,container:I},item:L,originalTarget:t}}))}}),m(l,"dragenter",function(e){var t=w(e),n=O(t,e);n&&n!==A&&(M=p(n.children,h(n,"items")).filter(function(e){return e!==u(l).placeholder}),n.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:S,index:D,container:I},destination:{container:n,itemsBeforeUpdate:M},item:L,originalTarget:t}}))),A=n}),m(l,"dragend",function(e){if(L){L.classList.remove(c.draggingClass),g(L,"aria-grabbed","false"),"true"===L.getAttribute("aria-copied")&&"true"!==h(L,"dropped")&&L.remove(),L.style.display=L.oldDisplay,delete L.oldDisplay;var t=Array.from(f.values()).map(function(e){return e.placeholder}).filter(function(e){return e instanceof HTMLElement}).filter(b)[0];t&&t.remove(),l.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:S,index:D,container:I},item:L}})),Y=L=A=null}}),m(l,"drop",function(e){if(x(l,L.parentElement)){e.preventDefault(),e.stopPropagation(),h(L,"dropped","true");var t=Array.from(f.values()).map(function(e){return e.placeholder}).filter(function(e){return e instanceof HTMLElement}).filter(b)[0];C(t,L),t.remove(),l.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:S,index:D,container:I},item:L}}));var n=u(l).placeholder,i=p(I.children,c.items).filter(function(e){return e!==n}),o=!0===this.isSortable?this:this.parentElement,r=p(o.children,h(o,"items")).filter(function(e){return e!==n}),a=E(L,Array.from(L.parentElement.children).filter(function(e){return e!==n})),s=E(L,r);S===a&&I===o||l.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:S,index:D,container:I,itemsBeforeUpdate:X,items:i},destination:{index:s,elementIndex:a,container:o,itemsBeforeUpdate:M,items:r},item:L}}))}});var i,o,r,a=(i=function(t,e,n){if(L)if(c.forcePlaceholderSize&&(u(t).placeholder.style.height=Y+"px"),-1<Array.from(t.children).indexOf(e)){var i=N(e),o=E(u(t).placeholder,e.parentElement.children),r=E(e,e.parentElement.children);if(Y<i){var a=i-Y,s=v(e).top;if(o<r&&n<s)return;if(r<o&&s+i-a<n)return}void 0===L.oldDisplay&&(L.oldDisplay=L.style.display),"none"!==L.style.display&&(L.style.display="none");var l=!1;try{l=v(e).top+e.offsetHeight/2<=n}catch(e){l=o<r}l?C(e,u(t).placeholder):y(e,u(t).placeholder),Array.from(f.values()).filter(function(e){return void 0!==e.placeholder}).forEach(function(e){e.placeholder!==u(t).placeholder&&e.placeholder.remove()})}else{var d=Array.from(f.values()).filter(function(e){return void 0!==e.placeholder}).map(function(e){return e.placeholder});-1!==d.indexOf(e)||t!==e||p(e.children,c.items).length||(d.forEach(function(e){return e.remove()}),e.appendChild(u(t).placeholder))}},void 0===(o=c.debounce)&&(o=0),function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];clearTimeout(r),r=setTimeout(function(){i.apply(void 0,e)},o)}),s=function(e){var t=e.target,n=!0===t.isSortable?t:O(t,e);if(t=P(n,t),L&&x(n,L.parentElement)&&"true"!==h(n,"_disabled")){var i=h(n,"opts");parseInt(i.maxItems)&&p(n.children,h(n,"items")).length>=parseInt(i.maxItems)&&L.parentElement!==n||(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect=!0===u(n).getConfig("copy")?"copy":"move",a(n,t,e.pageY))}};m(t.concat(l),"dragover",s),m(t.concat(l),"dragenter",s)}),e)}return W.destroy=function(e){i(e)},W.enable=function(e){R(e)},W.disable=function(e){var t,n,i;n=h(t=e,"opts"),i=d(p(t.children,n.items),n.handle),g(t,"aria-dropeffect","none"),h(t,"_disabled","true"),g(i,"draggable","false"),s(i,"mousedown")},W}();!function(f,u,m,i){function a(e,t){this.w=f(m),this.el=f(e),(t=t||n).rootClass!==i&&"dd"!==t.rootClass&&(t.listClass=t.listClass?t.listClass:t.rootClass+"-list",t.itemClass=t.itemClass?t.itemClass:t.rootClass+"-item",t.dragClass=t.dragClass?t.dragClass:t.rootClass+"-dragel",t.handleClass=t.handleClass?t.handleClass:t.rootClass+"-handle",t.collapsedClass=t.collapsedClass?t.collapsedClass:t.rootClass+"-collapsed",t.placeClass=t.placeClass?t.placeClass:t.rootClass+"-placeholder",t.noDragClass=t.noDragClass?t.noDragClass:t.rootClass+"-nodrag",t.noChildrenClass=t.noChildrenClass?t.noChildrenClass:t.rootClass+"-nochildren",t.emptyClass=t.emptyClass?t.emptyClass:t.rootClass+"-empty"),this.options=f.extend({},n,t),this.options.json!==i&&this._build(),this.init()}var r="ontouchstart"in m,g=function(){var e=m.createElement("div"),t=m.documentElement;if(!("pointerEvents"in e.style))return!1;e.style.pointerEvents="auto",e.style.pointerEvents="x",t.appendChild(e);var n=u.getComputedStyle&&"auto"===u.getComputedStyle(e,"").pointerEvents;return t.removeChild(e),!!n}(),n={contentCallback:function(e){return e.content?e.content:e.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(e,t,n){},onDragStart:function(e,t,n){},beforeDragStop:function(e,t,n){},listRenderer:function(e,t){var n="<"+t.listNodeName+' class="'+t.listClass+'">';return(n+=e)+"</"+t.listNodeName+">"},itemRenderer:function(e,t,n,i,o){var r=f.map(e,function(e,t){return" "+t+'="'+e+'"'}).join(" "),a="<"+i.itemNodeName+r+">";return a+="<"+i.handleNodeName+' class="'+i.handleClass+'">',a+="<"+i.contentNodeName+' class="'+i.contentClass+'">',a+=t,a+="</"+i.contentNodeName+">",a+="</"+i.handleNodeName+">",(a+=n)+"</"+i.itemNodeName+">"}};a.prototype={init:function(){var o=this;o.reset(),o.el.data("nestable-group",this.options.group),o.placeEl=f('<div class="'+o.options.placeClass+'"/>');var e=this.el.find(o.options.itemNodeName);f.each(e,function(e,t){var n=f(t),i=n.parent();o.setParent(n),i.hasClass(o.options.collapsedClass)&&o.collapseItem(i.parent())}),e.length||this.appendEmptyElement(this.el),o.el.on("click","button",function(e){if(!o.dragEl){var t=f(e.currentTarget),n=t.data("action"),i=t.parents(o.options.itemNodeName).eq(0);"collapse"===n&&o.collapseItem(i),"expand"===n&&o.expandItem(i)}});var t=function(e){var t=f(e.target);if(!t.hasClass(o.options.handleClass)){if(t.closest("."+o.options.noDragClass).length)return;t=t.closest("."+o.options.handleClass)}t.length&&!o.dragEl&&(o.isTouch=/^touch/.test(e.type),o.isTouch&&1!==e.touches.length||(e.preventDefault(),o.dragStart(e.touches?e.touches[0]:e)))},n=function(e){o.dragEl&&(e.preventDefault(),o.dragMove(e.touches?e.touches[0]:e))},i=function(e){o.dragEl&&(e.preventDefault(),o.dragStop(e.touches?e.changedTouches[0]:e))};r&&(o.el[0].addEventListener("touchstart",t,!1),u.addEventListener("touchmove",n,!1),u.addEventListener("touchend",i,!1),u.addEventListener("touchcancel",i,!1)),o.el.on("mousedown",t),o.w.on("mousemove",n),o.w.on("mouseup",i),o.el.bind("destroy-nestable",function(){r&&(o.el[0].removeEventListener("touchstart",t,!1),u.removeEventListener("touchmove",n,!1),u.removeEventListener("touchend",i,!1),u.removeEventListener("touchcancel",i,!1)),o.el.off("mousedown",t),o.w.off("mousemove",n),o.w.off("mouseup",i),o.el.off("click"),o.el.unbind("destroy-nestable"),o.el.data("nestable",null)})},destroy:function(){this.el.trigger("destroy-nestable")},add:function(e){var t="."+this.options.listClass,n=f(this.el).children(t);e.parent_id!==i&&(n=n.find('[data-id="'+e.parent_id+'"]'),delete e.parent_id,0===n.children(t).length&&(n=n.append(this.options.listRenderer("",this.options))),n=n.find(t+":first"),this.setParent(n.parent())),n.append(this._buildItem(e,this.options))},replace:function(e){var t=this._buildItem(e,this.options);this._getItemById(e.id).replaceWith(t)},removeItem:function(e){var t=this.options,n=this.el;(e=e||this).remove();var i="."+t.listClass+" ."+t.listClass+":not(:has(*))";f(n).find(i).remove(),f(n).find('[data-action="expand"], [data-action="collapse"]').each(function(){0===f(this).siblings("."+t.listClass).length&&f(this).remove()})},remove:function(e,t){var n=this.options,i=this,o=this._getItemById(e),r=n.effect.animation||"fade",a=n.effect.time||"slow";"fade"===r?o.fadeOut(a,function(){i.removeItem(o)}):this.removeItem(o),t&&t()},removeAll:function(e){function t(){r.each(function(){n.removeItem(f(this))}),o.show(),e&&e()}var n=this,i=this.options,o=n.el.find(i.listNodeName).first(),r=o.children(i.itemNodeName),a=i.effect.animation||"fade",s=i.effect.time||"slow";"fade"===a?o.fadeOut(s,t):t()},_getItemById:function(e){return f(this.el).children("."+this.options.listClass).find('[data-id="'+e+'"]')},_build:function(){var e=this.options.json;"string"==typeof e&&(e=JSON.parse(e)),f(this.el).html(this._buildList(e,this.options))},_buildList:function(e,n){if(!e)return"";var i="",o=this;return f.each(e,function(e,t){i+=o._buildItem(t,n)}),n.listRenderer(i,n)},_buildItem:function(o,e){var t=function(e){delete(e=f.extend({},e)).children,delete e.classes,delete e.content;var i={};return f.each(e,function(e,t){var n;"object"==typeof t&&(t=JSON.stringify(t)),i["data-"+e]=(n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},t+"".replace(/[&<>"']/g,function(e){return n[e]}))}),i}(o);t.class=function(e,t){var n=o.classes||{};"string"==typeof n&&(n=[n]);var i=function(e){var t={};for(var n in e)t[e[n]]=e[n];return t}(n);return i[t.itemClass]=t.itemClass,f.map(i,function(e){return e}).join(" ")}(0,e);var n=e.contentCallback(o),i=this._buildList(o.children,e),r=f(e.itemRenderer(t,n,i,e,o));return this.setParent(r),r[0].outerHTML},serialize:function(){var r=this,a=function(e){var o=[];return e.children(r.options.itemNodeName).each(function(){var e=f(this),t=f.extend({},e.data()),n=e.children(r.options.listNodeName);if(r.options.includeContent){var i=e.find("."+r.options.contentClass).html();i&&(t.content=i)}n.length&&(t.children=a(n)),o.push(t)}),o};return a(r.el.find(r.options.listNodeName).first())},asNestedSet:function(){function s(e){return f.isNumeric(e)&&Math.floor(e)==e}var l=this.options,d=[],e=1;return this.el.find(l.listNodeName).first().children(l.itemNodeName).each(function(){e=function e(t,n,i){var o,r,a=i+1;return 0<f(t).children(l.listNodeName).children(l.itemNodeName).length&&(n++,f(t).children(l.listNodeName).children(l.itemNodeName).each(function(){a=e(f(this),n,a)}),n--),s(o=f(t).attr("data-id"))&&(o=parseInt(o)),s(r=f(t).parent(l.listNodeName).parent(l.itemNodeName).attr("data-id")||"")&&(o=parseInt(r)),o&&d.push({id:o,parent_id:r,depth:n,lft:i,rgt:a}),a+1}(this,0,e)}),d=d.sort(function(e,t){return e.lft-t.lft})},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(e){var o=f.extend({},this.options,e),t=[];return f(this.element).children(o.items).each(function(){var e=function t(e){var n=(f(e).attr(o.attribute||"id")||"").match(o.expression||/(.+)[-=_](.+)/);if(n){var i={id:n[2]};return 0<f(e).children(o.listType).children(o.items).length&&(i.children=[],f(e).children(o.listType).children(o.items).each(function(){var e=t(this);i.children.push(e)})),i}}(this);t.push(e)}),t},toArray:function(){var s=f.extend({},this.options,this),l=s.startDepthCount||0,d=[],e=2;return this.el.find(this.options.listNodeName).first().children(this.options.itemNodeName).each(function(){e=function e(t,n,i){var o,r,a=i+1;return 0<t.children(s.options.listNodeName).children(s.options.itemNodeName).length&&(n++,t.children(s.options.listNodeName).children(s.options.itemNodeName).each(function(){a=e(f(this),n,a)}),n--),o=t.data().id,r=n===l+1?s.rootID:t.parent(s.options.listNodeName).parent(s.options.itemNodeName).data().id,o&&d.push({id:o,parent_id:r,depth:n,left:i,right:a}),a+1}(f(this),l+1,e)}),d=d.sort(function(e,t){return e.left-t.left})},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(e){e.removeClass(this.options.collapsedClass)},collapseItem:function(e){e.children(this.options.listNodeName).length&&e.addClass(this.options.collapsedClass)},expandAll:function(){var e=this;e.el.find(e.options.itemNodeName).each(function(){e.expandItem(f(this))})},collapseAll:function(){var e=this;e.el.find(e.options.itemNodeName).each(function(){e.collapseItem(f(this))})},setParent:function(e){e.is(this.options.itemNodeName)&&e.children(this.options.listNodeName).length&&(e.children("[data-action]").remove(),e.prepend(f(this.options.expandBtnHTML)),e.prepend(f(this.options.collapseBtnHTML)))},unsetParent:function(e){e.removeClass(this.options.collapsedClass),e.children("[data-action]").remove(),e.children(this.options.listNodeName).remove()},dragStart:function(e){var t=this.mouse,n=f(e.target).closest(this.options.itemNodeName),i={top:e.pageY,left:e.pageX},o=this.options.onDragStart.call(this,this.el,n,i);if(void 0===o||!1!==o){this.placeEl.css("height",n.height()),t.offsetX=e.pageX-n.offset().left,t.offsetY=e.pageY-n.offset().top,t.startX=t.lastX=e.pageX,t.startY=t.lastY=e.pageY,this.dragRootEl=this.el,this.dragEl=f(m.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",n.outerWidth()),this.setIndexOfItem(n),n.after(this.placeEl),n[0].parentNode.removeChild(n[0]),n.appendTo(this.dragEl),f(m.body).append(this.dragEl),this.dragEl.css({left:e.pageX-t.offsetX,top:e.pageY-t.offsetY});var r,a,s=this.dragEl.find(this.options.itemNodeName);for(r=0;r<s.length;r++)(a=f(s[r]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=a)}},createSubLevel:function(e,t){var n=f("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return t&&n.append(t),e.append(n),this.setParent(e),n},setIndexOfItem:function(e,t){(t=t||[]).unshift(e.index()),f(e[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(f(e[0].parentNode),t):this.dragEl.data("indexOfItem",t)},restoreItemAtIndex:function(e,t){for(var n=this.el,i=t.length-1,o=0;o<t.length;o++){if(i===parseInt(o))return a=n,s=e,void(0===t[i]?f(a).prepend(s.clone(!0)):f(a.children[t[i]-1]).after(s.clone(!0)));var r=n[0]?n[0]:n;n=r.children[t[o]]||this.createSubLevel(f(r))}var a,s},dragStop:function(e){var t={top:e.pageY,left:e.pageX},n=this.dragEl.data("indexOfItem"),i=this.dragEl.children(this.options.itemNodeName).first();i[0].parentNode.removeChild(i[0]),this.dragEl.remove();var o=this.options.beforeDragStop.call(this,this.el,i,this.placeEl.parent());if(void 0!==o&&!1===o){var r=this.placeEl.parent();return this.placeEl.remove(),r.children().length||this.unsetParent(r.parent()),this.restoreItemAtIndex(i,n),void this.reset()}this.placeEl.replaceWith(i),this.hasNewRoot?(!0===this.options.fixed?this.restoreItemAtIndex(i,n):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,i,t),this.reset()},dragMove:function(e){var t,n,i,o=this.options,r=this.mouse;this.dragEl.css({left:e.pageX-r.offsetX,top:e.pageY-r.offsetY}),r.lastX=r.nowX,r.lastY=r.nowY,r.nowX=e.pageX,r.nowY=e.pageY,r.distX=r.nowX-r.lastX,r.distY=r.nowY-r.lastY,r.lastDirX=r.dirX,r.lastDirY=r.dirY,r.dirX=0===r.distX?0:0<r.distX?1:-1,r.dirY=0===r.distY?0:0<r.distY?1:-1;var a=Math.abs(r.distX)>Math.abs(r.distY)?1:0;if(!r.moving)return r.dirAx=a,void(r.moving=!0);if(o.scroll)if(void 0!==u.jQuery.fn.scrollParent){var s=!1,l=this.el.scrollParent()[0];l!==m&&"HTML"!==l.tagName?(o.scrollTriggers.bottom+l.offsetHeight-e.pageY<o.scrollSensitivity?l.scrollTop=s=l.scrollTop+o.scrollSpeed:e.pageY-o.scrollTriggers.top<o.scrollSensitivity&&(l.scrollTop=s=l.scrollTop-o.scrollSpeed),o.scrollTriggers.right+l.offsetWidth-e.pageX<o.scrollSensitivity?l.scrollLeft=s=l.scrollLeft+o.scrollSpeed:e.pageX-o.scrollTriggers.left<o.scrollSensitivity&&(l.scrollLeft=s=l.scrollLeft-o.scrollSpeed)):(e.pageY-f(m).scrollTop()<o.scrollSensitivity?s=f(m).scrollTop(f(m).scrollTop()-o.scrollSpeed):f(u).height()-(e.pageY-f(m).scrollTop())<o.scrollSensitivity&&(s=f(m).scrollTop(f(m).scrollTop()+o.scrollSpeed)),e.pageX-f(m).scrollLeft()<o.scrollSensitivity?s=f(m).scrollLeft(f(m).scrollLeft()-o.scrollSpeed):f(u).width()-(e.pageX-f(m).scrollLeft())<o.scrollSensitivity&&(s=f(m).scrollLeft(f(m).scrollLeft()+o.scrollSpeed)))}else console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information");this.scrollTimer&&clearTimeout(this.scrollTimer),o.scroll&&s&&(this.scrollTimer=setTimeout(function(){f(u).trigger(e)},10)),r.dirAx!==a?(r.distAxX=0,r.distAxY=0):(r.distAxX+=Math.abs(r.distX),0!==r.dirX&&r.dirX!==r.lastDirX&&(r.distAxX=0),r.distAxY+=Math.abs(r.distY),0!==r.dirY&&r.dirY!==r.lastDirY&&(r.distAxY=0)),r.dirAx=a,r.dirAx&&r.distAxX>=o.threshold&&(r.distAxX=0,i=this.placeEl.prev(o.itemNodeName),0<r.distX&&i.length&&!i.hasClass(o.collapsedClass)&&!i.hasClass(o.noChildrenClass)&&(t=i.find(o.listNodeName).last(),this.placeEl.parents(o.listNodeName).length+this.dragDepth<=o.maxDepth&&(t.length?(t=i.children(o.listNodeName).last()).append(this.placeEl):this.createSubLevel(i,this.placeEl))),r.distX<0&&(this.placeEl.next(o.itemNodeName).length||(n=this.placeEl.parent(),this.placeEl.closest(o.itemNodeName).after(this.placeEl),n.children().length||this.unsetParent(n.parent()))));var d=!1;if(g||(this.dragEl[0].style.visibility="hidden"),this.pointEl=f(m.elementFromPoint(e.pageX-m.body.scrollLeft,e.pageY-(u.pageYOffset||m.documentElement.scrollTop))),g||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(o.handleClass)&&(this.pointEl=this.pointEl.closest(o.itemNodeName)),this.pointEl.hasClass(o.emptyClass))d=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(o.itemClass))return;var c=this.pointEl.closest("."+o.rootClass),h=this.dragRootEl.data("nestable-id")!==c.data("nestable-id");if(!r.dirAx||h||d){if(h&&o.group!==c.data("nestable-group"))return;if(this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(o.listNodeName).length)return;if(this.dragDepth-1+this.pointEl.parents(o.listNodeName).length>o.maxDepth)return;var p=e.pageY<this.pointEl.offset().top+this.pointEl.height()/2;n=this.placeEl.parent(),d?((t=f(m.createElement(o.listNodeName)).addClass(o.listClass)).append(this.placeEl),this.pointEl.replaceWith(t)):p?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),n.children().length||this.unsetParent(n.parent()),this.dragRootEl.find(o.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=c,h&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}},appendEmptyElement:function(e){e.append('<div class="'+this.options.emptyClass+'"/>')}},f.fn.nestable=function(i){var o=this,r=arguments;return"Nestable"in u||(u.Nestable={},Nestable.counter=0),this.each(function(){var e=f(this).data("nestable");if(e){if("string"==typeof i&&"function"==typeof e[i])if(1<r.length){for(var t=[],n=1;n<r.length;n++)t.push(r[n]);o=e[i].apply(e,t)}else o=e[i]()}else Nestable.counter++,f(this).data("nestable",new a(this,i)),f(this).data("nestable-id",Nestable.counter)}),o||this}}(window.jQuery||window.Zepto,window,document),piranha.blockpicker=new Vue({el:"#blockpicker",data:{categories:[],index:0,callback:null},methods:{load:function(e){fetch(piranha.baseUrl+"manager/api/content/blocktypes").then(function(e){return e.json()}).then(function(e){piranha.blockpicker.categories=e.categories}).catch(function(e){console.log("error:",e)})},open:function(e,t){this.index=e,this.callback=t,$("#blockpicker").modal("show")},select:function(e){this.callback(e.type,this.index),this.index=0,this.callback=null,$("#blockpicker").modal("hide")}},created:function(){this.load()}}),piranha.notifications=new Vue({el:"#notification-hub",data:{items:[]},methods:{push:function(e){e.style={visible:!1,"notification-info":"info"===e.type,"notification-danger":"danger"===e.type,"notification-success":"success"===e.type,"notification-warning":"warning"===e.type},piranha.notifications.items.push(e),setTimeout(function(){e.style.visible=!0,e.hide&&setTimeout(function(){e.style.visible=!1,setTimeout(function(){piranha.notifications.items.shift()},200)},5e3)},200)}}}),piranha.preview=new Vue({el:"#previewModal",data:{empty:{filename:null,type:null,contentType:null,publicUrl:null,size:null,width:null,height:null,lastModified:null},media:null},methods:{open:function(e){piranha.preview.load(e),piranha.preview.show()},load:function(e){fetch(piranha.baseUrl+"manager/api/media/"+e).then(function(e){return e.json()}).then(function(e){piranha.preview.media=e}).catch(function(e){console.log("error:",e)})},show:function(){$("#previewModal").modal("show")},close:function(){console.log("click"),$("#previewModal").modal("hide"),piranha.preview.clear()},clear:function(){this.media=this.empty}},created:function(){this.clear()}}),piranha.editor={addInline:function(e){tinymce.init({selector:"#"+e,menubar:!1,branding:!1,statusbar:!1,inline:!0,convert_urls:!1,plugins:["autoresize autolink code hr paste lists"],width:"100%",autoresize_min_height:0,toolbar:"bold italic | bullist numlist hr | alignleft aligncenter alignright | formatselect",block_formats:"Paragraph=p;Header 1=h1;Header 2=h2;Header 3=h3;Header 4=h4;Code=pre;Quote=blockquote"})},remove:function(e){tinymce.remove(tinymce.get(e))}};