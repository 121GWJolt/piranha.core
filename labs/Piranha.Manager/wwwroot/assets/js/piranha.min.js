!function(f,u,m,i){function l(t,e){this.w=f(m),this.el=f(t),(e=e||s).rootClass!==i&&"dd"!==e.rootClass&&(e.listClass=e.listClass?e.listClass:e.rootClass+"-list",e.itemClass=e.itemClass?e.itemClass:e.rootClass+"-item",e.dragClass=e.dragClass?e.dragClass:e.rootClass+"-dragel",e.handleClass=e.handleClass?e.handleClass:e.rootClass+"-handle",e.collapsedClass=e.collapsedClass?e.collapsedClass:e.rootClass+"-collapsed",e.placeClass=e.placeClass?e.placeClass:e.rootClass+"-placeholder",e.noDragClass=e.noDragClass?e.noDragClass:e.rootClass+"-nodrag",e.noChildrenClass=e.noChildrenClass?e.noChildrenClass:e.rootClass+"-nochildren",e.emptyClass=e.emptyClass?e.emptyClass:e.rootClass+"-empty"),this.options=f.extend({},s,e),this.options.json!==i&&this._build(),this.init()}var o="ontouchstart"in m,g=function(){var t=m.createElement("div"),e=m.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var s=u.getComputedStyle&&"auto"===u.getComputedStyle(t,"").pointerEvents;return e.removeChild(t),!!s}(),s={contentCallback:function(t){return t.content?t.content:t.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(t,e,s){},onDragStart:function(t,e,s){},beforeDragStop:function(t,e,s){},listRenderer:function(t,e){var s="<"+e.listNodeName+' class="'+e.listClass+'">';return(s+=t)+"</"+e.listNodeName+">"},itemRenderer:function(t,e,s,i,n){var o=f.map(t,function(t,e){return" "+e+'="'+t+'"'}).join(" "),l="<"+i.itemNodeName+o+">";return l+="<"+i.handleNodeName+' class="'+i.handleClass+'">',l+="<"+i.contentNodeName+' class="'+i.contentClass+'">',l+=e,l+="</"+i.contentNodeName+">",l+="</"+i.handleNodeName+">",(l+=s)+"</"+i.itemNodeName+">"}};l.prototype={init:function(){var n=this;n.reset(),n.el.data("nestable-group",this.options.group),n.placeEl=f('<div class="'+n.options.placeClass+'"/>');var t=this.el.find(n.options.itemNodeName);f.each(t,function(t,e){var s=f(e),i=s.parent();n.setParent(s),i.hasClass(n.options.collapsedClass)&&n.collapseItem(i.parent())}),t.length||this.appendEmptyElement(this.el),n.el.on("click","button",function(t){if(!n.dragEl){var e=f(t.currentTarget),s=e.data("action"),i=e.parents(n.options.itemNodeName).eq(0);"collapse"===s&&n.collapseItem(i),"expand"===s&&n.expandItem(i)}});var e=function(t){var e=f(t.target);if(!e.hasClass(n.options.handleClass)){if(e.closest("."+n.options.noDragClass).length)return;e=e.closest("."+n.options.handleClass)}e.length&&!n.dragEl&&(n.isTouch=/^touch/.test(t.type),n.isTouch&&1!==t.touches.length||(t.preventDefault(),n.dragStart(t.touches?t.touches[0]:t)))},s=function(t){n.dragEl&&(t.preventDefault(),n.dragMove(t.touches?t.touches[0]:t))},i=function(t){n.dragEl&&(t.preventDefault(),n.dragStop(t.touches?t.changedTouches[0]:t))};o&&(n.el[0].addEventListener("touchstart",e,!1),u.addEventListener("touchmove",s,!1),u.addEventListener("touchend",i,!1),u.addEventListener("touchcancel",i,!1)),n.el.on("mousedown",e),n.w.on("mousemove",s),n.w.on("mouseup",i),n.el.bind("destroy-nestable",function(){o&&(n.el[0].removeEventListener("touchstart",e,!1),u.removeEventListener("touchmove",s,!1),u.removeEventListener("touchend",i,!1),u.removeEventListener("touchcancel",i,!1)),n.el.off("mousedown",e),n.w.off("mousemove",s),n.w.off("mouseup",i),n.el.off("click"),n.el.unbind("destroy-nestable"),n.el.data("nestable",null)})},destroy:function(){this.el.trigger("destroy-nestable")},add:function(t){var e="."+this.options.listClass,s=f(this.el).children(e);t.parent_id!==i&&(s=s.find('[data-id="'+t.parent_id+'"]'),delete t.parent_id,0===s.children(e).length&&(s=s.append(this.options.listRenderer("",this.options))),s=s.find(e+":first"),this.setParent(s.parent())),s.append(this._buildItem(t,this.options))},replace:function(t){var e=this._buildItem(t,this.options);this._getItemById(t.id).replaceWith(e)},removeItem:function(t){var e=this.options,s=this.el;(t=t||this).remove();var i="."+e.listClass+" ."+e.listClass+":not(:has(*))";f(s).find(i).remove(),f(s).find('[data-action="expand"], [data-action="collapse"]').each(function(){0===f(this).siblings("."+e.listClass).length&&f(this).remove()})},remove:function(t,e){var s=this.options,i=this,n=this._getItemById(t),o=s.effect.animation||"fade",l=s.effect.time||"slow";"fade"===o?n.fadeOut(l,function(){i.removeItem(n)}):this.removeItem(n),e&&e()},removeAll:function(t){function e(){o.each(function(){s.removeItem(f(this))}),n.show(),t&&t()}var s=this,i=this.options,n=s.el.find(i.listNodeName).first(),o=n.children(i.itemNodeName),l=i.effect.animation||"fade",a=i.effect.time||"slow";"fade"===l?n.fadeOut(a,e):e()},_getItemById:function(t){return f(this.el).children("."+this.options.listClass).find('[data-id="'+t+'"]')},_build:function(){var t=this.options.json;"string"==typeof t&&(t=JSON.parse(t)),f(this.el).html(this._buildList(t,this.options))},_buildList:function(t,s){if(!t)return"";var i="",n=this;return f.each(t,function(t,e){i+=n._buildItem(e,s)}),s.listRenderer(i,s)},_buildItem:function(n,t){var e=function(t){delete(t=f.extend({},t)).children,delete t.classes,delete t.content;var i={};return f.each(t,function(t,e){var s;"object"==typeof e&&(e=JSON.stringify(e)),i["data-"+t]=(s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},e+"".replace(/[&<>"']/g,function(t){return s[t]}))}),i}(n);e.class=function(t,e){var s=n.classes||{};"string"==typeof s&&(s=[s]);var i=function(t){var e={};for(var s in t)e[t[s]]=t[s];return e}(s);return i[e.itemClass]=e.itemClass,f.map(i,function(t){return t}).join(" ")}(0,t);var s=t.contentCallback(n),i=this._buildList(n.children,t),o=f(t.itemRenderer(e,s,i,t,n));return this.setParent(o),o[0].outerHTML},serialize:function(){var o=this,l=function(t){var n=[];return t.children(o.options.itemNodeName).each(function(){var t=f(this),e=f.extend({},t.data()),s=t.children(o.options.listNodeName);if(o.options.includeContent){var i=t.find("."+o.options.contentClass).html();i&&(e.content=i)}s.length&&(e.children=l(s)),n.push(e)}),n};return l(o.el.find(o.options.listNodeName).first())},asNestedSet:function(){function a(t){return f.isNumeric(t)&&Math.floor(t)==t}var r=this.options,d=[],t=1;return this.el.find(r.listNodeName).first().children(r.itemNodeName).each(function(){t=function t(e,s,i){var n,o,l=i+1;return 0<f(e).children(r.listNodeName).children(r.itemNodeName).length&&(s++,f(e).children(r.listNodeName).children(r.itemNodeName).each(function(){l=t(f(this),s,l)}),s--),a(n=f(e).attr("data-id"))&&(n=parseInt(n)),a(o=f(e).parent(r.listNodeName).parent(r.itemNodeName).attr("data-id")||"")&&(n=parseInt(o)),n&&d.push({id:n,parent_id:o,depth:s,lft:i,rgt:l}),l+1}(this,0,t)}),d=d.sort(function(t,e){return t.lft-e.lft})},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(t){var n=f.extend({},this.options,t),e=[];return f(this.element).children(n.items).each(function(){var t=function e(t){var s=(f(t).attr(n.attribute||"id")||"").match(n.expression||/(.+)[-=_](.+)/);if(s){var i={id:s[2]};return 0<f(t).children(n.listType).children(n.items).length&&(i.children=[],f(t).children(n.listType).children(n.items).each(function(){var t=e(this);i.children.push(t)})),i}}(this);e.push(t)}),e},toArray:function(){var a=f.extend({},this.options,this),r=a.startDepthCount||0,d=[],t=2;return this.el.find(this.options.listNodeName).first().children(this.options.itemNodeName).each(function(){t=function t(e,s,i){var n,o,l=i+1;return 0<e.children(a.options.listNodeName).children(a.options.itemNodeName).length&&(s++,e.children(a.options.listNodeName).children(a.options.itemNodeName).each(function(){l=t(f(this),s,l)}),s--),n=e.data().id,o=s===r+1?a.rootID:e.parent(a.options.listNodeName).parent(a.options.itemNodeName).data().id,n&&d.push({id:n,parent_id:o,depth:s,left:i,right:l}),l+1}(f(this),r+1,t)}),d=d.sort(function(t,e){return t.left-e.left})},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options.listNodeName).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(f(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(f(this))})},setParent:function(t){t.is(this.options.itemNodeName)&&t.children(this.options.listNodeName).length&&(t.children("[data-action]").remove(),t.prepend(f(this.options.expandBtnHTML)),t.prepend(f(this.options.collapseBtnHTML)))},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,s=f(t.target).closest(this.options.itemNodeName),i={top:t.pageY,left:t.pageX},n=this.options.onDragStart.call(this,this.el,s,i);if(void 0===n||!1!==n){this.placeEl.css("height",s.height()),e.offsetX=t.pageX-s.offset().left,e.offsetY=t.pageY-s.offset().top,e.startX=e.lastX=t.pageX,e.startY=e.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=f(m.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",s.outerWidth()),this.setIndexOfItem(s),s.after(this.placeEl),s[0].parentNode.removeChild(s[0]),s.appendTo(this.dragEl),f(m.body).append(this.dragEl),this.dragEl.css({left:t.pageX-e.offsetX,top:t.pageY-e.offsetY});var o,l,a=this.dragEl.find(this.options.itemNodeName);for(o=0;o<a.length;o++)(l=f(a[o]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=l)}},createSubLevel:function(t,e){var s=f("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return e&&s.append(e),t.append(s),this.setParent(t),s},setIndexOfItem:function(t,e){(e=e||[]).unshift(t.index()),f(t[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(f(t[0].parentNode),e):this.dragEl.data("indexOfItem",e)},restoreItemAtIndex:function(t,e){for(var s=this.el,i=e.length-1,n=0;n<e.length;n++){if(i===parseInt(n))return l=s,a=t,void(0===e[i]?f(l).prepend(a.clone(!0)):f(l.children[e[i]-1]).after(a.clone(!0)));var o=s[0]?s[0]:s;s=o.children[e[n]]||this.createSubLevel(f(o))}var l,a},dragStop:function(t){var e={top:t.pageY,left:t.pageX},s=this.dragEl.data("indexOfItem"),i=this.dragEl.children(this.options.itemNodeName).first();i[0].parentNode.removeChild(i[0]),this.dragEl.remove();var n=this.options.beforeDragStop.call(this,this.el,i,this.placeEl.parent());if(void 0!==n&&!1===n){var o=this.placeEl.parent();return this.placeEl.remove(),o.children().length||this.unsetParent(o.parent()),this.restoreItemAtIndex(i,s),void this.reset()}this.placeEl.replaceWith(i),this.hasNewRoot?(!0===this.options.fixed?this.restoreItemAtIndex(i,s):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,i,e),this.reset()},dragMove:function(t){var e,s,i,n=this.options,o=this.mouse;this.dragEl.css({left:t.pageX-o.offsetX,top:t.pageY-o.offsetY}),o.lastX=o.nowX,o.lastY=o.nowY,o.nowX=t.pageX,o.nowY=t.pageY,o.distX=o.nowX-o.lastX,o.distY=o.nowY-o.lastY,o.lastDirX=o.dirX,o.lastDirY=o.dirY,o.dirX=0===o.distX?0:0<o.distX?1:-1,o.dirY=0===o.distY?0:0<o.distY?1:-1;var l=Math.abs(o.distX)>Math.abs(o.distY)?1:0;if(!o.moving)return o.dirAx=l,void(o.moving=!0);if(n.scroll)if(void 0!==u.jQuery.fn.scrollParent){var a=!1,r=this.el.scrollParent()[0];r!==m&&"HTML"!==r.tagName?(n.scrollTriggers.bottom+r.offsetHeight-t.pageY<n.scrollSensitivity?r.scrollTop=a=r.scrollTop+n.scrollSpeed:t.pageY-n.scrollTriggers.top<n.scrollSensitivity&&(r.scrollTop=a=r.scrollTop-n.scrollSpeed),n.scrollTriggers.right+r.offsetWidth-t.pageX<n.scrollSensitivity?r.scrollLeft=a=r.scrollLeft+n.scrollSpeed:t.pageX-n.scrollTriggers.left<n.scrollSensitivity&&(r.scrollLeft=a=r.scrollLeft-n.scrollSpeed)):(t.pageY-f(m).scrollTop()<n.scrollSensitivity?a=f(m).scrollTop(f(m).scrollTop()-n.scrollSpeed):f(u).height()-(t.pageY-f(m).scrollTop())<n.scrollSensitivity&&(a=f(m).scrollTop(f(m).scrollTop()+n.scrollSpeed)),t.pageX-f(m).scrollLeft()<n.scrollSensitivity?a=f(m).scrollLeft(f(m).scrollLeft()-n.scrollSpeed):f(u).width()-(t.pageX-f(m).scrollLeft())<n.scrollSensitivity&&(a=f(m).scrollLeft(f(m).scrollLeft()+n.scrollSpeed)))}else console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information");this.scrollTimer&&clearTimeout(this.scrollTimer),n.scroll&&a&&(this.scrollTimer=setTimeout(function(){f(u).trigger(t)},10)),o.dirAx!==l?(o.distAxX=0,o.distAxY=0):(o.distAxX+=Math.abs(o.distX),0!==o.dirX&&o.dirX!==o.lastDirX&&(o.distAxX=0),o.distAxY+=Math.abs(o.distY),0!==o.dirY&&o.dirY!==o.lastDirY&&(o.distAxY=0)),o.dirAx=l,o.dirAx&&o.distAxX>=n.threshold&&(o.distAxX=0,i=this.placeEl.prev(n.itemNodeName),0<o.distX&&i.length&&!i.hasClass(n.collapsedClass)&&!i.hasClass(n.noChildrenClass)&&(e=i.find(n.listNodeName).last(),this.placeEl.parents(n.listNodeName).length+this.dragDepth<=n.maxDepth&&(e.length?(e=i.children(n.listNodeName).last()).append(this.placeEl):this.createSubLevel(i,this.placeEl))),o.distX<0&&(this.placeEl.next(n.itemNodeName).length||(s=this.placeEl.parent(),this.placeEl.closest(n.itemNodeName).after(this.placeEl),s.children().length||this.unsetParent(s.parent()))));var d=!1;if(g||(this.dragEl[0].style.visibility="hidden"),this.pointEl=f(m.elementFromPoint(t.pageX-m.body.scrollLeft,t.pageY-(u.pageYOffset||m.documentElement.scrollTop))),g||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(n.handleClass)&&(this.pointEl=this.pointEl.closest(n.itemNodeName)),this.pointEl.hasClass(n.emptyClass))d=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(n.itemClass))return;var h=this.pointEl.closest("."+n.rootClass),c=this.dragRootEl.data("nestable-id")!==h.data("nestable-id");if(!o.dirAx||c||d){if(c&&n.group!==h.data("nestable-group"))return;if(this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(n.listNodeName).length)return;if(this.dragDepth-1+this.pointEl.parents(n.listNodeName).length>n.maxDepth)return;var p=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;s=this.placeEl.parent(),d?((e=f(m.createElement(n.listNodeName)).addClass(n.listClass)).append(this.placeEl),this.pointEl.replaceWith(e)):p?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),s.children().length||this.unsetParent(s.parent()),this.dragRootEl.find(n.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=h,c&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}},appendEmptyElement:function(t){t.append('<div class="'+this.options.emptyClass+'"/>')}},f.fn.nestable=function(i){var n=this,o=arguments;return"Nestable"in u||(u.Nestable={},Nestable.counter=0),this.each(function(){var t=f(this).data("nestable");if(t){if("string"==typeof i&&"function"==typeof t[i])if(1<o.length){for(var e=[],s=1;s<o.length;s++)e.push(o[s]);n=t[i].apply(t,e)}else n=t[i]()}else Nestable.counter++,f(this).data("nestable",new l(this,i)),f(this).data("nestable-id",Nestable.counter)}),n||this}}(window.jQuery||window.Zepto,window,document),piranha.notifications=new Vue({el:"#notification-hub",data:{items:[]},methods:{push:function(t){t.style={visible:!1,"notification-info":"info"===t.type,"notification-danger":"danger"===t.type,"notification-success":"success"===t.type,"notification-warning":"warning"===t.type},piranha.notifications.items.push(t),setTimeout(function(){t.style.visible=!0,t.hide&&setTimeout(function(){t.style.visible=!1,setTimeout(function(){piranha.notifications.items.shift()},200)},5e3)},200)}}});